#+TITLE: Emacs Config
* Custom
  #+BEGIN_SRC emacs-lisp
    (setq custom-file "~/.emacs.d/custom.el")
    (load custom-file)
  #+END_SRC
* Load package and add repos
  #+BEGIN_SRC emacs-lisp
    (require 'package)
    (add-to-list 'package-archives '("org" . "http://orgmode.org/elpa/"))
    (add-to-list 'package-archives '("melpa" . "http://melpa.org/packages/"))
    (add-to-list 'package-archives '("melpa-stable" . "http://stable.melpa.org/packages/"))
    (setq package-enable-at-startup nil)
    (package-initialize)
  #+END_SRC
* Have use-package automatically install packages
** Install use-package
   #+BEGIN_SRC emacs-lisp
     (unless (package-installed-p 'use-package)
       (package-refresh-contents)
       (package-install 'use-package))

     (eval-when-compile
       (require 'use-package))
   #+END_SRC
** Package List
*** Always load
    #+BEGIN_SRC emacs-lisp
       (setq use-package-always-ensure t)
    #+END_SRC
*** base16-theme
    #+BEGIN_SRC emacs-lisp
      (use-package base16-theme)
    #+END_SRC
*** company-mode
    #+BEGIN_SRC emacs-lisp
      (use-package company
        :init
        (add-hook 'after-init-hook 'global-company-mode))
    #+END_SRC
*** diminish
    #+BEGIN_SRC emacs-lisp
      (use-package diminish
        :disabled
        :init
        (diminish 'jiggle-mode))
    #+END_SRC
*** evil
    #+BEGIN_SRC emacs-lisp
      (use-package evil
        :init
        ;; Scroll up with C-u
        (setq evil-want-C-u-scroll t)
        :config
        ;; move by visual line
        (define-key evil-normal-state-map (kbd "j") 'evil-next-visual-line)
        (define-key evil-normal-state-map (kbd "k") 'evil-previous-visual-line)
        (use-package evil-leader
          :init
          (global-evil-leader-mode))
        (use-package evil-numbers
          :init
          (global-set-key (kbd "C-c C-=") 'evil-numbers/inc-at-pt)
          (global-set-key (kbd "C-c C--") 'evil-numbers/dec-at-pt))
        (use-package evil-org))
    #+END_SRC
*** flycheck
    #+BEGIN_SRC emacs-lisp
      (use-package flycheck
        :init
        (add-hook 'after-init-hook #'global-flycheck-mode))
    #+END_SRC
*** folding
    #+BEGIN_SRC emacs-lisp
      (use-package folding
        :disabled
        :init
        (load "folding" 'nomessage 'noerror)
        (folding-mode-add-find-file-hook)
        :config
        (folding-add-to-marks-list 'web-mode "<!-- {{{ " "<!-- }}} -->" " -->" nil t))
    #+END_SRC
*** git-gutter-fringe
    https://github.com/syohex/emacs-git-gutter-fringe
    #+BEGIN_SRC emacs-lisp
      (use-package git-gutter-fringe
        :init
        (global-git-gutter-mode t)
        (setq fringes-outside-margins t)
        :config
        (set-face-foreground 'git-gutter-fr:modified "#ebcb8b")
        (set-face-foreground 'git-gutter-fr:added    "#a3be8c")
        (set-face-foreground 'git-gutter-fr:deleted  "#bf616a")
        ;; https://github.com/hlissner/.emacs.d/blob/master/core/core-vcs.el#L24
        (define-fringe-bitmap 'git-gutter-fr:added
          [224 224 224 224 224 224 224 224 224 224 224 224 224 224 224 224 224 224 224 224 224 224 224 224 224]
          nil nil 'center)
        (define-fringe-bitmap 'git-gutter-fr:modified
          [224 224 224 224 224 224 224 224 224 224 224 224 224 224 224 224 224 224 224 224 224 224 224 224 224]
          nil nil 'center)
        (define-fringe-bitmap 'git-gutter-fr:deleted
          [224 224 224 224 224 224 224 224 224 224 224 224 224 224 224 224 224 224 224 224 224 224 224 224 224]
          nil nil 'center))
    #+END_SRC
*** helm
    #+BEGIN_SRC emacs-lisp
      (use-package helm
        :init
        (helm-mode 1)
        (global-set-key (kbd "M-x") 'helm-M-x))
    #+END_SRC
*** jdee
    #+BEGIN_SRC emacs-lisp
      (use-package jdee
        :disabled)
    #+END_SRC
*** magit
    #+BEGIN_SRC emacs-lisp
      (use-package magit
        :config
        (defadvice magit-status (around magit-fullscreen activate)
          (window-configuration-to-register :magit-fullscreen)
          ad-do-it
          (delete-other-windows))

        (defun magit-quit-session ()
          "Restores the previous window configuration and kills the magit buffer"
          (interactive)
          (kill-buffer)
          (jump-to-register :magit-fullscreen))

        (define-key magit-status-mode-map (kbd "q") 'magit-quit-session))
    #+END_SRC
*** nlinum
    #+BEGIN_SRC emacs-lisp
      (use-package nlinum)
    #+END_SRC
*** org-bullets
    #+BEGIN_SRC emacs-lisp
      (use-package org-bullets
        :init
        (add-hook 'org-mode-hook (lambda () (org-bullets-mode 1)))
        (setq org-bullets-bullet-list '("•")))
    #+END_SRC
*** powerline
    #+BEGIN_SRC emacs-lisp
      (use-package powerline
        :disabled
        :config
        (use-package airline-themes))
    #+END_SRC
*** powerline-evil
    #+BEGIN_SRC emacs-lisp
      (use-package powerline-evil
        :disabled
        :init
        (powerline-evil-vim-color-theme))
    #+END_SRC
*** rainbow-delimiters
    #+BEGIN_SRC emacs-lisp
      (use-package rainbow-delimiters
        :init
        (add-hook 'prog-mode-hook #'rainbow-delimiters-mode))
    #+END_SRC
*** web-mode
    #+BEGIN_SRC emacs-lisp
      (use-package web-mode)
    #+END_SRC
*** yasnippet
    #+BEGIN_SRC emacs-lisp
      (use-package yasnippet
        :disabled)
    #+END_SRC
* UI
** Cursor colour
   #+BEGIN_SRC emacs-lisp
     (set-cursor-color "#c0c5ce")
   #+END_SRC
** Font
   #+BEGIN_SRC emacs-lisp
     (set-face-attribute 'default nil :font "Source Code Pro 10")
   #+END_SRC
** Fringe colour
   http://emacs.stackexchange.com/a/5343
   #+BEGIN_SRC emacs-lisp
     (defun lia/tone-down-fringes ()
       "Set the fringe colour to the background colour."
       (set-face-attribute 'fringe nil
                           :foreground (face-foreground 'default)
                           :background (face-background 'default)))
     (lia/tone-down-fringes)
   #+END_SRC
** Highlight current line
   #+BEGIN_SRC emacs-lisp
     (global-hl-line-mode 1)
   #+END_SRC
** Modeline
   https://emacs-fu.blogspot.ca/2011/08/customizing-mode-line.html
   #+BEGIN_SRC emacs-lisp
     (setq-default mode-line-format
                   (list
                    ;; Any changes since last save?
                    " %* "

                    ;; the buffer name; the file name as a tool tip
                    '(:eval (propertize "%b " 'face 'font-lock-keyword-face
                                        'help-echo (buffer-file-name)))

                    ;; line and column
                    "(" ;; '%02' to set to 2 chars at least; prevents flickering
                    (propertize "%02l" 'face 'font-lock-type-face) ","
                    (propertize "%02c" 'face 'font-lock-type-face)
                    ") "

                    ;; the current major mode for the buffer.
                    "["
                    '(:eval (propertize "%m" 'face 'font-lock-string-face
                                        'help-echo buffer-file-coding-system))
                    "] "))
   #+END_SRC
** No welcome screen
   #+BEGIN_SRC emacs-lisp
     (setq inhibit-splash-screen t)
     (setq inhibit-startup-message t)
   #+END_SRC
* Org
** Hide formating characters
   #+BEGIN_SRC emacs-lisp
     (setq org-hide-emphasis-markers t)
   #+END_SRC
** Add timestamps when DONE
   #+BEGIN_SRC emacs-lisp
     (setq org-log-done 'time)
   #+END_SRC
** Agenda
   #+BEGIN_SRC emacs-lisp
     (setq org-agenda-files '("~/Dropbox/"))
   #+END_SRC
** Ellipsis
   #+BEGIN_SRC emacs-lisp
     (setq org-ellipsis " ⤵")
   #+END_SRC
** Source block languages
   #+BEGIN_SRC emacs-lisp
     (setq org-src-fontify-natively t)
     (org-babel-do-load-languages
      'org-babel-load-languages '((css . t)
				  (emacs-lisp . t)
				  (java . t)
				  (js . t)
				  (latex . t)
				  (lisp . t)
				  (org . t)
				  (perl . t)
				  (python . t)
				  (ruby . t)
				  (sh . t)))
   #+END_SRC
** TODO States
   #+BEGIN_SRC emacs-lisp
     (setq org-todo-keywords
           '((sequence "TODO(t)" "IN-PROGRESS(i)" "ON HOLD(h)" "WAITING(w)" "|" "DONE(d)" "CANCELED(c)")
             (sequence "[ ](T)" "[-](I)" "[*](W)" "|" "[X](D)")))
   #+END_SRC
* Other
** Easy quick edits
   #+BEGIN_SRC emacs-lisp
     (server-start)
   #+END_SRC
** Go to last change
   #+BEGIN_SRC emacs-lisp
     (global-set-key [(control meta .)] 'goto-last-change)
   #+END_SRC
** Move *~ files
   #+BEGIN_SRC emacs-lisp
     ;; Write backup files to own directory
     (setq backup-directory-alist
	   `(("." . ,(expand-file-name
		      (concat user-emacs-directory "backups")))))

     ;; Make backups of files, even when they're in version control
     (setq vc-make-backup-files t)
   #+END_SRC
** Scroll a line at a time
   #+BEGIN_SRC emacs-lisp
     (setq mouse-wheel-scroll-amount '(1 ((shift) . 1))) ;; one line at a time
     (setq mouse-wheel-progressive-speed nil) ;; don't accelerate scrolling
     (setq mouse-wheel-follow-mouse 't) ;; scroll window under mouse
     (setq scroll-step 1) ;; keyboard scroll one line at a time
   #+END_SRC
** Open window at the side
   #+BEGIN_SRC emacs-lisp
     (defun lia/window-switch-split ()
       "Switch between horizontal/vertical layout"
       (interactive)
       (if (= (count-windows) 2)
	   (let* ((this-win-buffer (window-buffer))
		  (next-win-buffer (window-buffer (next-window)))
		  (this-win-edges (window-edges (selected-window)))
		  (next-win-edges (window-edges (next-window)))
		  (this-win-2nd (not (and (<= (car this-win-edges)
					      (car next-win-edges))
					  (<= (cadr this-win-edges)
					      (cadr next-win-edges)))))
		  (splitter
		   (if (= (car this-win-edges)
			  (car (window-edges (next-window))))
		       'split-window-horizontally
		     'split-window-vertically)))
	     (delete-other-windows)
	     (let ((first-win (selected-window)))
	       (funcall splitter)
	       (if this-win-2nd (other-window 1))
	       (set-window-buffer (selected-window) this-win-buffer)
	       (set-window-buffer (next-window) next-win-buffer)
	       (select-window first-win)
	       (if this-win-2nd (other-window 1))))))
   #+END_SRC
** Remove duplicated words
   https://www.gnu.org/software/emacs/manual/html_node/eintr/the_002dthe.html
   #+BEGIN_SRC emacs-lisp
     (defun lia/the-the ()
       "Search forward for for a duplicated word."
       (interactive)
       (message "Searching for for duplicated words ...")
       (push-mark)

       (if (re-search-forward
            "\\b\\([^@ \n\t]+\\)[ \n\t]+\\1\\b" nil 'move)
           (message "Found duplicated word.")
         (message "End of buffer")))
   #+END_SRC
** Rotate windows
   #+BEGIN_SRC emacs-lisp
     (defun lia/window-rotate ()
       "Rotate your windows"
       (interactive)
       (cond ((not (> (count-windows)1))
	      (message "You can't rotate a single window!"))
	     (t
	      (setq i 1)
	      (setq numWindows (count-windows))
	      (while  (< i numWindows)
		(let* (
		       (w1 (elt (window-list) i))
		       (w2 (elt (window-list) (+ (% i numWindows) 1)))

		       (b1 (window-buffer w1))
		       (b2 (window-buffer w2))

		       (s1 (window-start w1))
		       (s2 (window-start w2))
		       )
		  (set-window-buffer w1  b2)
		  (set-window-buffer w2 b1)
		  (set-window-start w1 s2)
		  (set-window-start w2 s1)
		  (setq i (1+ i)))))))
   #+END_SRC
** Word wrap
   #+BEGIN_SRC emacs-lisp
     (global-visual-line-mode t)
   #+END_SRC
* These should be at the bottom
  #+BEGIN_SRC emacs-lisp
    (require 'evil-org 'evil)
    (evil-mode t)
    (find-file "~/Dropbox/todo.org")
    ;;(find-file "~/.emacs.d/config.org")
  #+END_SRC
